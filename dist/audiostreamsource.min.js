/**
 * @license audiostreamsource.js 0.1.2 Copyright (c) 2015, Gregg Tavares All Rights Reserved.
 * Available via the MIT license.
 * see: http://github.com/greggman/audiostreamsource.js for details
 */
!function(a,b){"function"==typeof define&&define.amd&&define([],b),"undefined"!=typeof module&&module.exports?module.exports=b():a.audioStreamSource=b()}(this,function(){function a(a,b,c){setTimeout(function(){c("no mic support on this browser/device")})}function b(a){var b={};return a.on=function(a,c){b[a]=c},emit=function(a){var c=b[a];c&&c.apply(null,Array.prototype.slice.call(arguments,1))}}function c(a,b){a()}function d(a){return"mic"===a}function e(a,b,c){i?setTimeout(function(){b(i)}):k.call(navigator,{audio:!0},function(c){i=a.createMediaStreamSource(c),b(i)},c)}function f(a){function f(b){return q=!1,l&&l.disconnect(),i()&&m.pause(),m&&(m.removeEventListener("error",s),m.removeEventListener("canplay",t),m.removeEventListener("ended",u),m=void 0),d(b)?void e(o,function(a){t(null,a)},s):(m=new Audio,m.loop=a.loop,m.autoplay=a.autoPlay,void 0!==a.crossOrigin&&(m.crossOrigin="anonymous"),m.addEventListener("error",s),m.addEventListener("canplay",t),m.addEventListener("ended",u),m.src=b,void m.load())}function g(){return l}function h(){r=!1,m&&(m.play(),m.currentTime=0)}function i(){return m&&!m.paused}function j(){return m?m.currentTime||0:0}function k(){return m?m.duration||0:0}console.log("using streaming audio");var l,m,n=b(this),o=a.context,p=a.autoPlay,q=!1,r=!1,s=function(a){n("error",a)},t=function(a,b){q||(q=!0,l&&(l.disconnect(),l=void 0),b?l=b:((p||r)&&c(h,n),l||(l=o.createMediaElementSource(m))),n("newSource",l))},u=function(){n("ended")};a.src&&f(a.src),this.isPlaying=i,this.play=function(){q?c(h,n):r=!0},this.stop=function(){m&&m.pause()},this.setSource=f,this.getSource=g,this.getDuration=k,this.getCurrentTime=j}function g(a){function f(){p=t.createBufferSource(),p.buffer=q,p.loop=u,r=!1}function g(){p&&p===i||q&&(r&&(f(),s("newSource",p)),r=!0,p.start(0),p.onended=m,y=Date.now(),x=!0)}function h(){p&&p===i||(p&&x&&(p.onended=void 0,p.stop(0),z=Date.now()),x=!1)}function j(){return x}function k(){return p&&p!==i?p.buffer.duration:0}function l(){if(p&&p!==i&&x){var a=.001*(Date.now()-y);return a%p.buffer.duration}return 0}function m(){s("ended")}function n(a,b){if(p&&(h(),p.disconnect(),p=void 0),d(a))return void e(t,function(a){p=a,s("newSource",a)},function(a){s("error",a)});var i=new XMLHttpRequest;i.open("GET",b||a,!0),i.responseType="arraybuffer",void 0!==w&&(i.withCredentials=!0),i.addEventListener("error",function(a){s("error",a)}),i.addEventListener("load",function(){t.decodeAudioData(i.response,function(a){q=a,f(),v&&c(g,s),s("newSource",p)})}),i.send()}function o(){return p}console.log("using NON-streaming audio");var p,q,r,s=b(this),t=a.context,u=a.loop,v=a.autoPlay,w=a.crossOrigin,x=!1,y=Date.now(),z=Date.now();a.src&&n(a.src,a.lofiSrc),this.getSource=o,this.setSource=n,this.play=g,this.stop=h,this.isPlaying=j,this.getDuration=k,this.getCurrentTime=l}function h(a){return new(j?g:f)(a)}var i,j=/Android|iPhone|iPad|iPod/.test(navigator.userAgent),k=(/^((?!chrome|android).)*safari/i.test(navigator.userAgent),navigator.getUserMedia||navigator.webkitGetUserMedia||a);return{create:h}});